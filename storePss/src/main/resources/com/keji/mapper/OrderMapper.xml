<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.keji.mapper.OrderMapper">
    <resultMap id="order" type="com.keji.pojo.Order">
        <result property="orderId" column="order_id"></result>
        <result property="orderCusId" column="order_cusId"></result>
        <result property="orderAggregateAmount" column="order_aggregateAmount"></result>
        <result property="orderEmpId" column="order_empId"></result>
        <result property="orderCreateDate" column="order_createDate"></result>
        <result property="orderUpdateDate" column="order_updateDate"></result>
        <result property="orderState" column="order_state"></result>
        <result property="orderDeposit" column="order_deposit"></result>
        <result property="orderFullPayment" column="order_fullPayment"></result>
        <result property="orderRemark" column="order_remark"></result>
        <result property="orderCashPledge" column="order_cashPledge"></result>
        <result property="customer.customerName" column="customer_name"></result>
        <result property="userInfo.userName" column="user_describe"></result>
    </resultMap>
    <!--查询所有订单-->
    <select id="getAllOrder" resultMap="order">
        select * from t_order
    </select>

    <!--添加订单-->
    <insert id="addOrder" parameterType="com.keji.pojo.Order">
        insert into t_order values(#{orderId},#{orderCusId},#{orderAggregateAmount},#{orderEmpId},#{orderCreateDate},#{orderUpdateDate},
        #{orderState},#{orderDeposit},#{orderFullPayment},#{orderRemark},#{orderCashPledge})
    </insert>

    <!--修改订单押金-->
    <update id="updateOrder">
        update t_order set order_cashPledge=#{yajin} where order_id=#{orderId}
    </update>

    <!--根据订单编号查询订单-->
    <select id="findOrder" resultMap="order">
        SELECT order_id,customer_name,order_aggregateAmount,t_order.order_createDate,order_cashPledge
        FROM t_order
        INNER JOIN t_customer ON t_order.`order_cusId`=t_customer.`customer_id`
        WHERE order_id=#{orderId} and order_fullPayment=1
    </select>

    <!--修改订单全款状态-->
    <update id="updateFullPayment">
        update t_order set order_fullPayment=0 where order_id=#{orderId}
    </update>

    <!--查询售后订单-->
    <select id="findRefundOrder" resultMap="order">
        SELECT order_id,customer_name,order_aggregateAmount,order_createDate,user_describe
        FROM t_order
        INNER JOIN t_customer ON t_order.`order_cusId`=t_customer.`customer_id`
        INNER JOIN t_user ON t_user.`user_id`=t_order.`order_empId`
        WHERE order_fullPayment=0 and order_id=#{orderId}
    </select>


    <!--根据订单编号删除订单-->
    <delete id="delOrder">
        delete from t_order where order_id=#{orderId}
    </delete>
</mapper>
